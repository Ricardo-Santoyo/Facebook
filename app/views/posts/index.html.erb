<h1>Your Timeline</h1>

<ul id="posts">
  <% @posts.each do |post| %>
    <li class="post">
      Posted by: <%= link_to post.user.name, user_path(post.user) %><br />
      <%= post.body %><br />
      <%= post.likes.count %> Likes
      <%= post.comments.count %> Comments
      <% if post.likes.map(&:user).include?(current_user) %>
        <%= button_to "Unlike", {:controller => "likes", :action => "destroy", :id => post.likes.find_by(user:current_user).id}, :method=>:delete %>
      <% else %>
        <%= button_to "Like", {:controller => "likes", :action => "create", :user_id => current_user.id, :post_id => post.id}, :method=>:post %>
      <% end %>

      <%= render 'comments/form', post_id: post.id %>
      <%= render partial: 'comment', collection: post.comments %>
    </li>
  <% end %>
</ul>